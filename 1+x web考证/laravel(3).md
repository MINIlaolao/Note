---
typora-root-url: images
---

# 1、DB数据库操作

## 1.1、配置数据库的连接

1、查看数据库配置文件

![1573605670818](/1573605670818.png)

在配置文件中关于数据库的配置信息部分信息使用了env函数获取。env函数用于获取环境变量(.env文件中的数据)或者返回默认值。因此配置数据库的连接可以修改这两个文件

2、手动创建数据库与表

![1573605856300](/1573605856300.png)

3、修改database.php配置文件

![1573605885202](/1573605885202.png)

4、修改.env文件

![1573605975529](/1573605975529.png)

## 1.2、执行原生SQL语句

### 1.2.1、数据写入

写入数据使用DB类直接调用静态的insert方法完成

1、语法格式

```php
DB::insert($sql,$bind=[]);
```

2、创建路由

![1573606318719](/1573606318719.png)

3、创建写入数据的方法

![1573606604262](/1573606604262.png)

执行之后返回结果为布尔值

4、使用?占位符号

![1573606968981](/1573606968981.png)

5、使用:占位符号

由于?占位符需要手动的对应数组的顺序容易混淆。使用:占位符号直接使用关联索引

![1573607273868](/1573607273868.png)

### 1.2.2、数据修改

1、语法

```php
DB::update($sql,$bind)
```

2、创建方法修改数据

![1573607985159](/1573607985159.png)

3、执行结果

![1573608002984](/1573608002984.png)

### 1.2.3、数据查询

使用DB类执行原生SQL语句查询提供select与selectOne方法。select查询多条数据，selectOne查询单条数据

1、查询单条

![1573608268306](/1573608268306.png)

2、结果

![1573608360192](/1573608360192.png)

3、查询多条数据

![1573608398460](/1573608398460.png)

4、多条数据结果

![1573608462338](/1573608462338.png)

5、多条数据的遍历

![1573608557147](/1573608557147.png)

结果

![1573608566970](/1573608566970.png)

### 1.2.4、数据删除

1、语法

```php
DB::delete($sql,$bind=[]);
```

2、实现删除

![1573608680156](/1573608680156.png)

在DB门面下可以使用statement方法执行一些不返回数据的通用SQL语句一般用于操作数据库的语句

## 1.3、DB构建器使用

在原生SQL语句中通过四个(增删改查)方法可以完全实现数据库的交互。但是如果考虑项目的通用性需要使用构建

器完成数据库操作。由于后期可能数据库迁移例如从MySQL数据将数据转移到了SQLserver数据库。最终需要对

项目代码中涉及到的SQL语句都进行修改。使用构建器的方式最终在执行数据库操作时不需要指定SQL语句

即使用构建器框架会根据所调用的方法自动转换为SQL语句最终执行

### 1.3.1、数据写入

1、设置数据增删改查的路由

![1573609183606](/1573609183606.png)

2、创建写入方法获取对象

![1573609368394](/1573609368394.png)

结果

![1573609378722](/1573609378722.png)

3、使用对象调用insert方法写入

![1573609648746](/1573609648746.png)

在使用构建器时是没有SQL语句指定的。每一个方法的调用目的是为了设置SQL语句中的某一部分 最终框架转换为完整的SQL语句在执行

3、使用insert写入多条数据

![1573609797062](/1573609797062.png)

在写入数据时 使用一维数组表示单条数据。使用二维方式表示多条数据

4、使用insertGetId写入数据

insertGetId方法只能写入单条数据。最终返回的是写入数据的主键标识



![1573609941624](/1573609941624.png)

结果

![1573609960300](/1573609960300.png)

### 1.3.2、数据查询

在数据查询中可以通过使用get方法、first方法、value方法实现数据查询

1、查询方法的说明

| 方法              | 作用                                     |
| ----------------- | ---------------------------------------- |
| get()             | 查询满足条件的所有数据                   |
| first()           | 查询满足条件的一条数据                   |
| value('字段名称') | 只得到一条数据并且只获取到指定字段的信息 |

2、get方法使用

a)创建方法查询多条数据

![1573611353395](/1573611353395.png)

b)执行结果格式

![1573611418584](/1573611418584.png)

c)对结果集进行循环

如果需要对每一条数据进行操作可以直接对返回结果集进行循环

![1573611490782](/1573611490782.png)

d)执行结果

![1573611501404](/1573611501404.png)

3、first方法使用

![1573611618103](/1573611618103.png)

执行结果

![1573611645614](/1573611645614.png)

4、使用value方法

![1573611854938](/1573611854938.png)



![1573611862821](/1573611862821.png)

### 1.3.3、查询数据的其他方法

1、方法使用格式

```php
//方法名称=需要根据框架中所提供的方法调用。并且也可以调用多个
DB::table(表名称)->方法名称()->get/first/value（）	
```

2、常用的其他方法

| 方法名称                          | 作用                                                |
| --------------------------------- | --------------------------------------------------- |
| **where(字段名称,符号,对比的值)** | 用于设置查询语句中的where条件 表示并且(and)关系     |
| orWhere(字段名称,符号,对比的值)   | 用于设置where条件但是表示或者(or)关系               |
| select('字段列表')                | 用于指定要查询的字段信息                            |
| limit(数字)                       | 用于设置查询数据的条目数 即原生SQL语句中的limit子句 |
| offset(数字)                      | 用于指定偏移量                                      |
| orderBy('字段名称',‘排序方式’)    | 用于指定排序方式 即原生SQL语句中的order by子句      |

3、演示其他方法使用

```php
public function select(){
		$obj = DB::table('user');
		// orderBy排序
		$data = $obj->where('id','>',10)->select(['id','name'])->orderBy('id','desc')->limit(2)->offset(2)->get();
		dd($data);
		// select 方法指定字段
		$data = $obj->where('id','>',10)->select(['id','name'])->limit(2)->offset(2)->get();
		dd($data);
		// offset 查询到数据之后偏移多少条数据
		$data = $obj->where('id','>',10)->limit(2)->offset(2)->get();
		
		// 设置limit 限制条目数量
		$data = $obj->where('id','>',10)->limit(2)->get();
		// 指定查询id = 15的数据
		$res = $obj->where('id','=',15)->first();
		// where方法的省略写法 where方法中比较符号默认使用=
		$res = $obj->where('id',15)->first();
		// 指定条件查询 id = 15 and name = 'zhangsan'
		$res = $obj->where('id',15)->where('name','zhangsan')->first();
		// 调用一次where方法指定多个条件
		$res = $obj->where([
			'id'=>15,
			'name'=>'zhangsan'
		])->first();
		// 指定条件查询 id = 15 or name = 'zhangsan'
		$res = $obj->where('id',15)->orWhere('name','zhangsan')->first();
	}
```

### 1.3.4、数据修改

![1573613864853](/1573613864853.png)

### 1.3.5、数据删除

![1573613911706](/1573613911706.png)

