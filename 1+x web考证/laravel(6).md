---
typora-root-url: images
---

# 1、CSRF

## 1.1、使用案例

1、创建路由

![1574210390627](/1574210390627.png)

上面的路由表示当访问submit地址时可以使用get与post方式发生请求。其中get方式表示要显示表单。post方式的请求表示提交数据处理

2、创建处理get方法

![1574210557666](/1574210557666.png)

3、创建模板

![1574210637624](/1574210637624.png)

4、处理数据的提交

![1574210702152](/1574210702152.png)

5、post表单提交的效果

![1574210748504](/1574210748504.png)

出现上面的报错的原因是由于laravel框架默认开启了CSRF防护

6、关闭submit地址对应的CSRF防护

![1574210873652](/1574210873652.png)

7、再次提交数据

![1574210886250](/1574210886250.png)

8、使用postman发生请求

postman是一个开发常用的工具，可以用于进行接口的调试

![1574211065516](/1574211065516.png)

上面可以通过工具发送请求。因此也可以实现表单提交。此时如果有人恶意的模拟请求提交数据。可能会对项目存在一定的风险。因此需要使用CSRF进行防护

## 1.2、CSRF介绍

CSRF即 跨站[请求](http://laravelacademy.org/tags/请求)伪造是一种通过伪装授权用户的请求来利用授信网站的恶意漏洞。例如使用钓鱼网站诱导用户输出信息骗取金额

![1574211595762](/1574211595762.png)

对于上面的招商银行处理表单提交的程序应该要拒绝其他第三方的所有的请求，只处理自己项目的请求

## 1.3、在框架中使用csrf防护

1、去掉例外的路由

![1574211728491](/1574211728491.png)

2、修改模板

![1574211803031](/1574211803031.png)

3、浏览器访问查看表单源码

![1574211859344](/1574211859344.png)

4、再次提交表单

![1574211916899](/1574211916899.png)

# 2、模型

## 2.1、模型说明

在laravel框架中虽然又DB门面可以完成数据库的操作。但是不利于项目的封装。因此模型可以对项目进行封装。

并且在MVC中模型起到数据交互的能力

在框架中模型注意点：

1、模型类对应数据表

2、对象对应数据行

3、对象下的属性对应着字段数据

## 2.2、创建模型

### 2.2.1、创建模型规则

1、存储目录：存储在app目录下，该目录下每一个文件就是一个模型

2、文件名称：模型名称+.php。模型名称一般需要与数据表同名

### 2.2.2、创建模型

1、查看当前数据表

![1574213061730](/1574213061730.png)

2、使用命令行方式
![1574213136314](/1574213136314.png)

3、指定对应关系

![1574213380739](/1574213380739.png)

4、指定主键字段信息

![1574213539457](/1574213539457.png)

5、设置关闭时间

![1574213682741](/1574213682741.png)

6、设置容许写入的字段

![1574213858330](/1574213858330.png)

## 2.3、获取模型对象

### 2.3.1、new关键字获取对象

1、创建路由

![1574214009359](/1574214009359.png)

2、创建方法

![1574214126757](/1574214126757.png)

3、结果

![1574214156270](/1574214156270.png)

### 2.3.2、查询数据获取对象

![1574214320249](/1574214320249.png)

结果

![1574214343584](/1574214343584.png)

后期在使用模型对象时，如果需要调用模型下自定义的方法推荐使用new的方式获取对象。如果直接使用模型基类的方法可以直接调用静态方法使用

## 2.4、模型数据写入

### 2.4.1、save方法实现

save方法实现数据写入是通过设置对象下的属性后调用方法完成

1、创建路由

![1574215992210](/1574215992210.png)

2、创建方法

![1574216135265](/1574216135265.png)

### 2.4.2、create方法实现

使用create方法需要与模型中的fillable属性配合

![1574216271880](/1574216271880.png)

## 2.5、数据修改

在模型中需要修改数据先将数据查询然后在设置要修改字段对应的属性最后调用save方法修改。save方法可以用于添加与修改数据。当调用对象的属性下存在主键字段时表示为修改操作

![1574216479493](/1574216479493.png)











## 2.6、数据删除

![1574216603887](/1574216603887.png)

## 2.7、数据的查询

模型查询数据可以始于find方法查询单条数据。使用all方法查询多条数据

1、使用find方法

![1574216873816](/1574216873816.png)

结果

![1574216887522](/1574216887522.png)

2、使用all方法

![1574217098141](/1574217098141.png)

结果

![1574217112261](/1574217112261.png)

3、模型对象调用DB下的方法

a)调用where方法

![1574217258815](/1574217258815.png)

b）结果

![1574217270077](/1574217270077.png)

c)调用方法查询

![1574217304233](/1574217304233.png)

结果

![1574217312460](/1574217312460.png)

如果一旦调用DB下的方法转换对象后只能调用DB下的方法

d)调用DB下的方法

![1574217381706](/1574217381706.png)

结果

![1574217392152](/1574217392152.png)



